<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">

    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-+0n0xVW2eSR5OomGNYDnhzAbDsOXxcvSN1TPprVMTNDbiYZCxYbOOl7+AMvyTG2x" crossorigin="anonymous">


    <title>Group</title>
</head>
<body>

<style>
    body{
        margin: 1vw;
        padding: 1vw;
    }
    #group{
        margin-top: 5vh;
        margin-left: 20vw;
        margin-right: 20vw;
    }

    #goods{
        margin-top: 3vh;
        margin-left: 20vw;
        margin-right: 20vw;

        height: 50vh;
        overflow: auto;
    }
    #bottom{
        margin-top: 5vh;
        margin-left: 5vw;
    }

    #firstButton {
        margin-top: 5vh;
        margin-left: 20vw;
        margin-right: 20vw;
    }
</style>

<div id="group">
</div>

<div id="firstButton">
<button type="button" class="btn btn-outline-primary">Update group</button>
<button type="button" class="btn btn-outline-danger" onclick="deleteGroup()">Delete group</button>
<button type="button" class="btn btn-outline-primary" onclick="show()" >Show products in this group</button>
</div>

<div id="goods" class="list">
    <div class="list-group goods">
    </div>
</div>

<div id="bottom">
<button type="button" class="btn btn-outline-primary" onclick="document.location='main.html'">Back to the main page</button>
</div>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-gtEjrD/SeCtmISkJkNUaaKMoLD0//ElJ19smozuHV6z3Iehds+3Ulb9Bn9Plx0x4" crossorigin="anonymous"></script>

<script>

    getGroup();

    function getGroup(){
        jQuery.ajax({
            url: "http://localhost:5000/api/group/"+sessionStorage.getItem("group"),
            method: 'GET',
            success: function (json) {
                console.log(json);
                json = json.replace(/'/g,'"');
                var obj = JSON.parse(json);
                console.log(obj);

                $("#group").append("<p id='groupName' class='title'> "+ obj["groupname"]+
                    "</p><hr style='margin: 5px;'>" +
                    "<p style='font-size: 13px;'>"+obj["description"]+"</p>");
            }
        });
    }
    //

    function deleteGroup(){
        if(!confirm("Do you really want to delete this group?"))
            return;

        $.ajax({
            url: "http://localhost:5000/api/group/"+sessionStorage.getItem("group"),
            method: 'DELETE',
            success: function (){
                document.location = "main.html";
            }
        });
    }

    function show(){
        $(".goods").empty();
        jQuery.ajax({
            url:'http://localhost:5000/api/goods/'+sessionStorage.getItem("group"),
            method:'GET',
            success : function (json) {
                console.log(json);
                var array = JSON.parse(json);
                console.log("array - " + array);
                for(var i=0; i<array.length; i++) {
                    var ar = array[i].split("#");
                    $(".goods")
                        .append("<button id='goods/"+ ar[1] +"' onclick='clickOnProduct(" + ar[1]+ ")' type='button' class='list-group-item list-group-item-action'>" + ar[0] + "</button>");
                }
            }
        });
    }

    function clickOnProduct(id){
        sessionStorage.setItem("good",id);
        document.location='good.html';
    }

</script>

</body>
</html>